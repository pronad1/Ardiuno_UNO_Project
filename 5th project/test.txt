#define BLYNK_PRINT Serial
#define BLYNK_TEMPLATE_ID "TMPL68IRbcKwK"
#define BLYNK_TEMPLATE_NAME "Smart plant"
#define BLYNK_AUTH_TOKEN "FYbzBOPgV2tEFXVUv1PLoDN0av99P7UN"
#include <ESP8266_Lib.h>
#include <BlynkSimpleShieldEsp8266.h>
#include <SoftwareSerial.h>

// --- 1. YOUR CREDENTIALS ---
// #define BLYNK_TEMPLATE_ID "TMPL68IRbcKwK"
// #define BLYNK_TEMPLATE_NAME "Smart plant"
char auth[] = "FYbzBOPgV2tEFXVUv1PLoDN0av99P7UN"; // Your Auth Token
char ssid[] = "Wi-Fi";       // REPLACE THIS
char pass[] = "openwifi123";   // REPLACE THIS

// --- 2. PIN SETTINGS ---
#define PUMP_PIN 6    // Relay connected here
#define RX_PIN 2      // Connect to ESP TX
#define TX_PIN 3      // Connect to ESP RX

// --- 3. ESP8266 OBJECTS ---
SoftwareSerial EspSerial(RX_PIN, TX_PIN);
ESP8266 wifi(&EspSerial);

void setup() {
  // Debug Console
  Serial.begin(115200);

  // ESP8266 Serial (Must be 9600!)
  EspSerial.begin(9600);
  delay(10);

  // Initialize Pump Pin
  pinMode(PUMP_PIN, OUTPUT);
  // Start with Pump OFF. 
  // NOTE: If your relay is "Low Trigger", HIGH = OFF. 
  digitalWrite(PUMP_PIN, HIGH); 

  // Connect to Cloud
  Serial.println("Connecting to Blynk...");
  Blynk.begin(auth, wifi, ssid, pass);
  Serial.println("Blynk Connected! Ready to test.");
}

void loop() {
  Blynk.run();
}

// --- 4. BLYNK BUTTON LOGIC (V12) ---
// This function runs automatically when you press the button in the app
BLYNK_WRITE(V12) {
  int pinValue = param.asInt(); // Get value from App (0 = OFF, 1 = ON)

  Serial.print("App Button Pressed: ");
  Serial.println(pinValue);

  if (pinValue == 1) {
    // App says ON -> Turn Relay ON
    // If your relay works backward, change LOW to HIGH here
    digitalWrite(PUMP_PIN, LOW); 
    Serial.println("Pump Turned ON");
  } else {
    // App says OFF -> Turn Relay OFF
    // If your relay works backward, change HIGH to LOW here
    digitalWrite(PUMP_PIN, HIGH);
    Serial.println("Pump Turned OFF");
  }
}

ESP8266 Pin, Connect to Arduino Pin
VCC / 3V3,3.3V
GND, GND
CH_PD (EN),3.3V
RX, Pin 3
TX, Pin 2

Pump Power Wiring:

Pump VCC (+) -> Connect to Relay COM (Common).

Relay NO (Normally Open) -> Connect to the External Battery's Positive (+) terminal.

Pump GND (-) -> Connect to External Battery Negative (-).
